<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Interactive AWS Savings Plan cost optimization simulator. Visualize savings across different load patterns.">
    <title>AWS Savings Plan Simulator | Interactive Cost Optimizer</title>
    <link rel="stylesheet" href="css/styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3.0.1/dist/chartjs-plugin-annotation.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/pako@2.1.0/dist/pako.min.js"></script>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <h1 class="title">
                    <span class="title-icon">üìä</span>
                    AWS Savings Plan Simulator
                </h1>
                <p class="subtitle">
                    Visualize and optimize your AWS compute costs with interactive Savings Plan scenarios
                </p>
            </div>
        </header>

        <!-- Global Color Theme Selector -->
        <div class="global-theme-selector">
            <label for="color-theme" class="theme-label">Color Theme:</label>
            <select id="color-theme" class="theme-select">
                <option value="default">Default</option>
                <option value="high-contrast">High Contrast</option>
                <option value="protanopia">Protanopia (Red-blind)</option>
                <option value="tritanopia">Tritanopia (Blue-blind)</option>
            </select>
        </div>

        <!-- Main Content -->
        <main class="main-content">

            <!-- Section 1: Load Pattern Editor -->
            <div class="section-header-with-toggle">
                <div class="section-header-row">
                    <div>
                        <h2 class="section-title">Workload Pattern & Cost Range</h2>
                        <p class="section-description">Define your usage pattern and hourly cost range (min-max $/h)</p>
                    </div>
                    <button id="toggle-load-pattern" class="button-toggle" aria-label="Toggle load pattern section">
                        <span class="toggle-icon">‚ñº</span>
                    </button>
                </div>
            </div>

            <div id="load-pattern-content" class="collapsible-content">
                <div class="cost-metrics-grid">
                    <!-- Load Pattern Chart (3/4 width) -->
                    <section class="card section-load-chart">
                        <div class="chart-container">
                            <canvas id="load-chart" aria-label="Weekly load pattern chart"></canvas>
                        </div>
                    </section>

                    <!-- Load Pattern Controls (1/4 width) -->
                    <section class="card section-load-controls">
                        <div class="card-header">
                            <h2 class="section-title">Pattern Settings</h2>
                        </div>

                        <div class="controls-column">
                            <div class="control-group">
                                <label for="pattern-select" class="control-label">Pattern Type</label>
                                <select id="pattern-select" class="select-input">
                                    <option value="ecommerce">E-commerce (Weekday peaks)</option>
                                    <option value="global247">Global 24/7 (Consistent load)</option>
                                    <option value="batch">Batch Processing (Scheduled spikes)</option>
                                    <option value="custom">Custom (Real Usage Data)</option>
                                </select>
                            </div>

                            <div class="control-group">
                                <label for="min-cost" class="control-label">
                                    Min Cost ($/h)
                                    <span class="control-hint">Baseline hourly cost</span>
                                </label>
                                <input type="number" id="min-cost" class="number-input" value="15" min="0" max="10000" step="1">
                            </div>

                            <div class="control-group">
                                <label for="max-cost" class="control-label">
                                    Max Cost ($/h)
                                    <span class="control-hint">Peak hourly cost</span>
                                </label>
                                <input type="number" id="max-cost" class="number-input" value="100" min="1" max="10000" step="1">
                            </div>
                        </div>
                    </section>
                </div>
            </div>

            <!-- Section 2: Cost Comparison Chart & Metrics Grid -->
            <div class="cost-metrics-grid">
                <!-- Cost Comparison Chart (3/4 width) -->
                <section class="card section-cost-comparison">
                    <div class="card-header">
                        <h2 class="section-title">Cost Breakdown: Coverage vs Actual Usage</h2>
                        <p class="section-description">Move the sliders below to see how coverage and savings affect costs</p>
                    </div>

                    <div class="chart-container">
                        <canvas id="cost-chart" aria-label="Cost comparison chart"></canvas>
                    </div>

                    <!-- Sliders in two columns directly below chart -->
                    <div class="sliders-row">
                        <div class="control-group">
                            <label for="coverage-slider" class="control-label">
                                Commitment
                                <span class="control-value" id="coverage-display">$50/h</span>
                            </label>
                            <input type="range" id="coverage-slider" class="slider" min="0" max="100" value="50" step="1" aria-label="Savings Plan commitment in dollars per hour">
                            <div class="control-hint" id="coverage-units">Covers $X/h on-demand</div>
                        </div>

                        <div class="control-group">
                            <label for="savings-percentage" class="control-label">
                                Savings Percentage
                                <span class="control-value" id="savings-display">30%</span>
                            </label>
                            <input type="range" id="savings-percentage" class="slider" min="0" max="99" value="30" step="1" aria-label="Savings percentage">
                            <div class="control-hint" id="savings-rate">$0.070/h vs $0.100/h On-Demand</div>
                        </div>
                    </div>

                    <!-- Commitment Strategy Buttons -->
                    <div class="sliders-row">
                        <div class="strategy-container">
                            <div class="strategy-buttons">
                                <button class="strategy-button strategy-warning" data-strategy="too-prudent" id="strategy-too-prudent">
                                    <div class="strategy-icon">üêî</div>
                                    <div class="strategy-content">
                                        <div class="strategy-name">Too Prudent</div>
                                        <div class="strategy-desc">Under-committed</div>
                                        <div class="strategy-metrics">
                                            <div class="strategy-metric-col">
                                                <div class="strategy-metric-label">Cost / h</div>
                                                <div class="strategy-value" id="strategy-too-prudent-value">$0.00/h</div>
                                                <div class="strategy-min-hourly-pct" id="strategy-too-prudent-min-hourly-pct">100.0% Min-Hourly</div>
                                            </div>
                                            <div class="strategy-metric-col">
                                                <div class="strategy-metric-label">Savings / h</div>
                                                <div class="strategy-savings-amount" id="strategy-too-prudent-savings">$0.00/h</div>
                                                <div class="strategy-savings-pct" id="strategy-too-prudent-savings-pct">0.0%</div>
                                            </div>
                                        </div>
                                    </div>
                                </button>
                                <button class="strategy-button" data-strategy="min-hourly" id="strategy-min">
                                    <div class="strategy-icon">üõ°Ô∏è</div>
                                    <div class="strategy-content">
                                        <div class="strategy-name">Min-Hourly</div>
                                        <div class="strategy-desc">Baseline only</div>
                                        <div class="strategy-metrics">
                                            <div class="strategy-metric-col">
                                                <div class="strategy-metric-label">Cost / h</div>
                                                <div class="strategy-value" id="strategy-min-value">$0.00/h</div>
                                                <div class="strategy-min-hourly-pct" id="strategy-min-min-hourly-pct">100.0% Min-Hourly</div>
                                            </div>
                                            <div class="strategy-metric-col">
                                                <div class="strategy-metric-label">Savings / h</div>
                                                <div class="strategy-savings-amount" id="strategy-min-savings">$0.00/h</div>
                                                <div class="strategy-savings-pct" id="strategy-min-savings-pct">0.0%</div>
                                            </div>
                                        </div>
                                    </div>
                                </button>
                                <button class="strategy-button strategy-recommended" data-strategy="balanced" id="strategy-balanced">
                                    <div class="strategy-icon">‚öñÔ∏è</div>
                                    <div class="strategy-content">
                                        <div class="strategy-name">Balanced</div>
                                        <div class="strategy-desc">Knee point</div>
                                        <div class="strategy-metrics">
                                            <div class="strategy-metric-col">
                                                <div class="strategy-metric-label">Cost / h</div>
                                                <div class="strategy-value" id="strategy-balanced-value">$0.00/h</div>
                                                <div class="strategy-min-hourly-pct" id="strategy-balanced-min-hourly-pct">100.0% Min-Hourly</div>
                                            </div>
                                            <div class="strategy-metric-col">
                                                <div class="strategy-metric-label">Savings / h</div>
                                                <div class="strategy-savings-amount" id="strategy-balanced-savings">$0.00/h</div>
                                                <div class="strategy-savings-pct" id="strategy-balanced-savings-pct">0.0%</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="strategy-badge">RECOMMENDED</div>
                                </button>
                                <button class="strategy-button" data-strategy="aggressive" id="strategy-aggressive">
                                    <div class="strategy-icon">üöÄ</div>
                                    <div class="strategy-content">
                                        <div class="strategy-name">Aggressive</div>
                                        <div class="strategy-desc">Max savings</div>
                                        <div class="strategy-metrics">
                                            <div class="strategy-metric-col">
                                                <div class="strategy-metric-label">Cost / h</div>
                                                <div class="strategy-value" id="strategy-aggressive-value">$0.00/h</div>
                                                <div class="strategy-min-hourly-pct" id="strategy-aggressive-min-hourly-pct">100.0% Min-Hourly</div>
                                            </div>
                                            <div class="strategy-metric-col">
                                                <div class="strategy-metric-label">Savings / h</div>
                                                <div class="strategy-savings-amount" id="strategy-aggressive-savings">$0.00/h</div>
                                                <div class="strategy-savings-pct" id="strategy-aggressive-savings-pct">0.0%</div>
                                            </div>
                                        </div>
                                    </div>
                                </button>
                                <button class="strategy-button strategy-warning" data-strategy="too-aggressive" id="strategy-too-aggressive">
                                    <div class="strategy-icon">üíÄ</div>
                                    <div class="strategy-content">
                                        <div class="strategy-name">Too Aggressive</div>
                                        <div class="strategy-desc">Over-committed</div>
                                        <div class="strategy-metrics">
                                            <div class="strategy-metric-col">
                                                <div class="strategy-metric-label">Cost / h</div>
                                                <div class="strategy-value" id="strategy-too-aggressive-value">$0.00/h</div>
                                                <div class="strategy-min-hourly-pct" id="strategy-too-aggressive-min-hourly-pct">100.0% Min-Hourly</div>
                                            </div>
                                            <div class="strategy-metric-col">
                                                <div class="strategy-metric-label">Savings / h</div>
                                                <div class="strategy-savings-amount" id="strategy-too-aggressive-savings">$0.00/h</div>
                                                <div class="strategy-savings-pct" id="strategy-too-aggressive-savings-pct">0.0%</div>
                                            </div>
                                        </div>
                                    </div>
                                </button>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Hourly Cost Summary (1/4 width) -->
                <section class="card section-metrics">
                    <div class="card-header">
                        <h2 class="section-title">Hourly Cost Summary</h2>
                    </div>

                    <div class="metrics-column">
                        <div class="metric-item">
                            <div class="metric-header">
                                <div class="metric-value" id="metric-ondemand">$0.00</div>
                                <div class="metric-label">Pure On-Demand Cost</div>
                            </div>
                        </div>

                        <div class="metric-item">
                            <div class="metric-header">
                                <div class="metric-value" id="metric-commitment">$0.00</div>
                                <div class="metric-label">SP Commitment Cost</div>
                            </div>
                            <div class="metric-subvalue" id="metric-commitment-pct">0.0% of total</div>
                        </div>

                        <div class="metric-item highlight">
                            <div class="metric-header">
                                <div class="metric-value" id="metric-savingsplan">$0.00</div>
                                <div class="metric-label">Total Cost with SP</div>
                            </div>
                            <div class="metric-subvalue" id="metric-breakdown">(Commitment + Spillover)</div>
                        </div>

                        <div class="metric-item" id="metric-savings-container">
                            <div class="metric-header">
                                <div class="metric-value" id="metric-savings">$0.00</div>
                                <div class="metric-label">Net Savings</div>
                            </div>
                            <div class="metric-subvalue" id="metric-savings-pct">0.0%</div>
                        </div>

                        <div class="metric-item warning">
                            <div class="metric-header">
                                <div class="metric-value" id="metric-spillover">$0.00</div>
                                <div class="metric-label">Spillover Cost</div>
                            </div>
                            <div class="metric-subvalue" id="metric-spillover-pct">0.0% of total</div>
                        </div>

                        <div class="metric-item warning">
                            <div class="metric-header">
                                <div class="metric-value" id="metric-waste">$0.00</div>
                                <div class="metric-label">Wasted Commitment</div>
                            </div>
                            <div class="metric-subvalue" id="metric-waste-pct">0.0% of commitment</div>
                        </div>
                    </div>

                    <button id="share-button" class="button button-primary">
                        <span class="button-icon">üîó</span>
                        Share Configuration
                    </button>
                </section>
            </div>

            <!-- Section 3: Savings Optimization Chart -->
            <section class="card section-savings-curve">
                <div class="card-header">
                    <h2 class="section-title">Savings vs Commitment Level</h2>
                    <p class="section-description">Net savings (% of baseline cost) at different commitment levels - zoomed to viable range</p>
                </div>

                <!-- Chart and Load Factor Control -->
                <div class="curve-with-control">
                    <div class="chart-container">
                        <canvas id="savings-curve-chart" aria-label="Savings curve optimization chart"></canvas>
                    </div>

                    <div class="curve-vertical-control">
                        <div class="control-group">
                            <label for="load-factor" class="control-label">
                                Load Factor
                                <span class="control-value" id="load-factor-display">100%</span>
                            </label>
                            <input type="range" id="load-factor" class="slider slider-vertical" min="50" max="200" value="100" step="1" aria-label="Load factor percentage" orient="vertical">
                            <div class="control-hint" id="load-factor-hint">Original usage level</div>
                        </div>
                    </div>
                </div>

                <div class="curve-legend">
                    <div class="legend-item">
                        <span class="legend-color" id="legend-building"></span>
                        <span class="legend-text">0-Min: Building to min-hourly baseline</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-color" id="legend-gaining"></span>
                        <span class="legend-text">Min-Optimal: Extra savings beyond baseline</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-color" id="legend-wasting"></span>
                        <span class="legend-text">Optimal-MinReturn: Declining back to baseline</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-color" id="legend-veryBad"></span>
                        <span class="legend-text">Worse than min-hourly: Not worth the commitment</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-color" id="legend-losingMoney"></span>
                        <span class="legend-text">Worse than on-demand: Losing money</span>
                    </div>
                </div>
            </section>

        </main>

        <!-- Footer -->
        <footer class="footer">
            <div class="footer-content">
                <div class="footer-links">
                    <a href="https://github.com/etiennechabert/terraform-aws-sp-autopilot" target="_blank" rel="noopener" class="footer-link">
                        <span class="footer-link-icon">‚öôÔ∏è</span>
                        Deploy with Terraform
                    </a>
                    <a href="https://github.com/etiennechabert/terraform-aws-sp-autopilot#readme" target="_blank" rel="noopener" class="footer-link">
                        <span class="footer-link-icon">üìñ</span>
                        Documentation
                    </a>
                    <a href="https://github.com/etiennechabert/terraform-aws-sp-autopilot" target="_blank" rel="noopener" class="footer-link">
                        <span class="footer-link-icon">‚≠ê</span>
                        Star on GitHub
                    </a>
                </div>
                <p class="footer-text">
                    Built for the <strong><a href="https://github.com/etiennechabert/terraform-aws-sp-autopilot" target="_blank" rel="noopener" style="color: inherit; text-decoration: none; border-bottom: 1px dotted currentColor;">terraform-aws-sp-autopilot</a></strong> project<br>
                    <span style="opacity: 0.7; font-size: 0.9em;">Open source on GitHub | Apache License 2.0</span>
                </p>
            </div>
        </footer>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast" role="alert" aria-live="polite"></div>

    <!-- Scripts -->
    <script src="js/colorThemes.js"></script>
    <script src="js/loadPatterns.js"></script>
    <script src="js/spCalculations.js"></script>
    <script src="js/costCalculator.js"></script>
    <script src="js/urlState.js"></script>
    <script src="js/chartManager.js"></script>
    <script src="js/main.js"></script>
</body>
</html>
